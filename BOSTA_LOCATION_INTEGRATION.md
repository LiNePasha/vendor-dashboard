# ุชูุงูู ููุงูุน Bosta ูู ูููุฐุฌ ุงูุนููู

## ุงูุชุญุฏูุซุงุช ุงููููุฐุฉ โ

### 1. Component ุฌุฏูุฏ: `BostaLocationSelector`
**ุงูููู**: `components/BostaLocationSelector.js`

Component ุฐูู ูุชุญูู ูู ุชูุนูู Bosta:
- **ุฅุฐุง Bosta ููุนูุฉ**: ูุนุฑุถ Dropdowns ูู Bosta API (ูุฏู โ ููุงุทู โ zones)
- **ุฅุฐุง Bosta ุบูุฑ ููุนูุฉ**: ูุนุฑุถ Text Inputs ุนุงุฏูุฉ

#### ุงููููุฒุงุช:
- โ ุชุญููู ุงููุฏู ูู Bosta API (ูุน countryId ูุตุฑ: `60e4482c7cb7d4bc4849c4d5`)
- โ Cascading Dropdowns (ุงููุฏููุฉ โ ุงูููุทูุฉ โ Zone)
- โ Cache ุฐูู (7 ุฃูุงู) ูุชุฌูุจ ุชูุฑุงุฑ API calls
- โ Loading states ููู dropdown
- โ ูุญูุธ ุงููุตูุต (city, district) ูุงูู IDs (cityId, districtId, zoneId)

#### ุงูุงุณุชุฎุฏุงู:
```jsx
<BostaLocationSelector
  address={form.address}
  onAddressChange={(newAddress) => setForm({ ...form, address: newAddress })}
  disabled={loading}
/>
```

---

### 2. ุชุญุฏูุซ `CustomerModal`
**ุงูููู**: `components/CustomerModal.js`

#### ุงูุชุบููุฑุงุช:
- โ ุฅุถุงูุฉ Import ูู `BostaLocationSelector`
- โ ุชุญุฏูุซ Address Structure ูุฏุนู Bosta IDs:
  ```javascript
  address: {
    street: '',
    city: '',         // Display name
    cityId: '',       // Bosta ID (ุฌุฏูุฏ)
    state: '',
    district: '',     // Display name (ุฌุฏูุฏ)
    districtId: '',   // Bosta ID (ุฌุฏูุฏ)
    zoneId: '',       // Bosta ID (ุงุฎุชูุงุฑู - ุฌุฏูุฏ)
    area: '',
    building: '',
    floor: '',
    apartment: '',
    landmark: ''
  }
  ```
- โ ุงุณุชุจุฏุงู text inputs ุจู `BostaLocationSelector`
- โ ุฏุนู Edit Mode (ุชุญููู cityId/districtId ุงูููุฌูุฏุฉ)

---

### 3. ุชุญุฏูุซ `offline-customers-storage`
**ุงูููู**: `app/lib/offline-customers-storage.js`

#### ุงูุชุบููุฑุงุช:
- โ ุฅุถุงูุฉ ุญููู `cityId`, `districtId`, `zoneId`, `district` ูู Address Structure
- โ ุงูุชุฃูุฏ ูู ุญูุธ ุฌููุน ุญููู Bosta ุนูุฏ ุฅุถุงูุฉ/ุชุญุฏูุซ ุนููู

---

### 4. Bosta API Methods (ููุฌูุฏุฉ ูุณุจูุงู)
**ุงูููู**: `app/lib/bosta-api.js`

#### ุงูุฏูุงู ุงููุณุชุฎุฏูุฉ:
- `getCities()` - ุฌูุจ ุงููุฏู ุงููุตุฑูุฉ
- `getDistricts(cityId)` - ุฌูุจ ุงูููุงุทู ููุฏููุฉ ูุนููุฉ
- `getZones(cityId)` - ุฌูุจ ุงูู Zones ููุฏููุฉ ูุนููุฉ

---

### 5. Bosta Cache System (ููุฌูุฏุฉ ูุณุจูุงู)
**ุงูููู**: `app/lib/bosta-locations-cache.js`

#### ุงูุฏูุงู ุงููุณุชุฎุฏูุฉ:
- `getCitiesCache()`, `saveCitiesCache(cities)`
- `getDistrictsCache(cityId)`, `saveDistrictsCache(cityId, districts)`
- `getZonesCache(cityId)`, `saveZonesCache(cityId, zones)`
- ูุฏุฉ ุงูู Cache: **7 ุฃูุงู**

---

## ุณูุฑ ุงูุนูู (Workflow) ๐

### ุนูุฏ ุฅูุดุงุก ุนููู ุฌุฏูุฏ:

1. **ุงููุณุชุฎุฏู ููุชุญ ูููุฐุฌ ุงูุนููู** โ `CustomerModal`

2. **Component ูุชุญูู ูู Bosta**:
   - ูุฌูุจ Settings ูู LocalForage
   - ุฅุฐุง `enabled: true` && `apiKey` ููุฌูุฏ:
     - ูุนุฑุถ Bosta Dropdowns
   - ูุฅูุง:
     - ูุนุฑุถ Text Inputs ุนุงุฏูุฉ

3. **ุชุญููู ุงููุฏู**:
   - ูุชุญูู ูู Cache ุฃููุงู
   - ุฅุฐุง ููุฌูุฏุฉ: ูุนุฑุถูุง
   - ุฅุฐุง ุบูุฑ ููุฌูุฏุฉ: ูุฌูุจูุง ูู Bosta API + ูุญูุธูุง ูู Cache

4. **ุงููุณุชุฎุฏู ูุฎุชุงุฑ ูุฏููุฉ**:
   - ูุญูุธ `city` (ุงููุต) ู `cityId` (ุงูู ID)
   - ูุฌูุจ ุงูููุงุทู ูุงูู Zones ููุฐู ุงููุฏููุฉ (ุจููุณ ููุทู Cache)

5. **ุงููุณุชุฎุฏู ูุฎุชุงุฑ ููุทูุฉ**:
   - ูุญูุธ `district` (ุงููุต) ู `districtId` (ุงูู ID)

6. **ุงูุญูุธ**:
   - ูุญูุธ ุฌููุน ุงูุญููู (ุจูุง ูููุง IDs) ูู LocalForage
   - `offline-customers-storage` ูุญูุธ ุงูุจูุงูุงุช ูุงููุฉ

---

## ุงูุจูุงูุงุช ุงููุญููุธุฉ ูู ุงูุนููุงู ๐พ

### ูุจู ุงูุชุญุฏูุซ โ:
```javascript
{
  city: 'Cairo',     // ููุท ุงููุต
  area: 'Maadi'      // ููุท ุงููุต
}
```
**ูุดููุฉ**: ุนูุฏ ุฅุฑุณุงู ูุจูุณุทุฉ โ Validation Error (cityId, districtId ูุทููุจุฉ)

### ุจุนุฏ ุงูุชุญุฏูุซ โ:
```javascript
{
  city: 'Cairo',           // ุงููุต ููุนุฑุถ
  cityId: '60e...',        // ID ูุจูุณุทุฉ API
  district: 'Maadi',       // ุงููุต ููุนุฑุถ
  districtId: '60e...',    // ID ูุจูุณุทุฉ API
  zoneId: '60e...',        // ุงุฎุชูุงุฑู
  area: 'ุงูุญู ุงูุนุงุดุฑ'     // ุญูู ุฅุถุงูู ูุญูู
}
```
**ูุชูุฌุฉ**: ุฅุฑุณุงู ูุงุฌุญ ูุจูุณุทุฉ โ

---

## ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูููุฌูุฏุฉ ๐

### ุงูุนููุงุก ุงููุฏุงูู (Legacy Customers):
- **ุฅุฐุง ูุง ููุฌุฏ `cityId` ุฃู `districtId`**:
  - ุนูุฏ ูุญุงููุฉ ุงูุฅุฑุณุงู ูุจูุณุทุฉ โ ุณูุธูุฑ Validation Error
  - **ุงูุญู**: ุชุญุฏูุซ ุจูุงูุงุช ุงูุนููู ูู ุฎูุงู "Edit Customer"
  - ุนูุฏ ุงูุชุญุฏูุซ: ุณูุธูุฑ Bosta Dropdowns ูุงุฎุชูุงุฑ ุงููุฏููุฉ ูุงูููุทูุฉ ุงูุตุญูุญุฉ

### ุงูุฃูุธูุฉ ุงูุฃุฎุฑู:
- Text Inputs ุงูุนุงุฏูุฉ ูุง ุฒุงูุช ููุฌูุฏุฉ (city, area, etc.)
- ูู ูุชุฃุซุฑ ุฃู ูุธุงู ุขุฎุฑ ูุง ูุณุชุฎุฏู Bosta

---

## ุงุฎุชุจุงุฑ ุงูููุฒุฉ ๐งช

### ุงูุณููุงุฑูู 1: Bosta ููุนูุฉ โ

1. ุงูุชุญ **ุงูุฅุนุฏุงุฏุงุช** โ ุฃุฏุฎู API Key โ ุงุถุบุท "ุงุฎุชุจุงุฑ ุงูุงุชุตุงู"
2. ุงูุชุญ **POS** โ ุงุถุบุท "ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ"
3. โ ูุฌุจ ุฃู ุชุธูุฑ Dropdowns ูููุฏููุฉ ูุงูููุทูุฉ
4. ุงุฎุชุฑ ูุฏููุฉ โ ุงูุชุธุฑ ุชุญููู ุงูููุงุทู
5. ุงุฎุชุฑ ููุทูุฉ โ ุงุญูุธ
6. ุฃูุดุฆ ุทูุจ ุชูุตูู ููุฐุง ุงูุนููู
7. ุงุถุบุท "๐ฆ ุฅุฑุณุงู ูุจูุณุทุฉ"
8. โ ูุฌุจ ุฃู ูุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ

### ุงูุณููุงุฑูู 2: Bosta ุบูุฑ ููุนูุฉ โ๏ธ

1. ุงูุชุญ **ุงูุฅุนุฏุงุฏุงุช** โ ุชุฃูุฏ ุฃู Bosta ุบูุฑ ููุนูุฉ (ุฃู API Key ูุงุฑุบ)
2. ุงูุชุญ **POS** โ ุงุถุบุท "ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ"
3. โ ูุฌุจ ุฃู ุชุธูุฑ Text Inputs ุนุงุฏูุฉ
4. ุฃุฏุฎู ุงูุจูุงูุงุช ูุฏููุงู โ ุงุญูุธ
5. โ ุงูุนููู ูุญูุธ ุจุดูู ุทุจูุนู

### ุงูุณููุงุฑูู 3: ุชุนุฏูู ุนููู ููุฌูุฏ ๐

1. ุงูุชุญ **ุงูุนููุงุก** โ ุงุฎุชุฑ ุนููู
2. ุงุถุบุท "ุชุนุฏูู"
3. โ ูุฌุจ ุชุญููู ุงููุฏููุฉ ูุงูููุทูุฉ ุงูููุฌูุฏุฉ
4. ุฅุฐุง Bosta ููุนูุฉ ูููุฌุฏ `cityId`:
   - โ ูุฌุจ ุชุญููู ุงูููุงุทู ูููุฏููุฉ ุงููุญููุธุฉ
5. ุบููุฑ ุงูุจูุงูุงุช โ ุงุญูุธ
6. โ ุงูุชุญุฏูุซุงุช ุชุญูุธ ุจูุฌุงุญ

---

## ุงููููุงุช ุงููุนุฏูุฉ ๐

| ุงูููู | ููุน ุงูุชุบููุฑ | ุงููุตู |
|------|------------|-------|
| `components/BostaLocationSelector.js` | โ ุฌุฏูุฏ | Component ุงุฎุชูุงุฑ ุงูููุงูุน |
| `components/CustomerModal.js` | ๐ง ุชุนุฏูู | ุฏูุฌ BostaLocationSelector |
| `app/lib/offline-customers-storage.js` | ๐ง ุชุนุฏูู | ุฅุถุงูุฉ ุญููู Bosta IDs |
| `app/lib/bosta-api.js` | โ ููุฌูุฏ ูุณุจูุงู | ุฏูุงู API (getCities, etc.) |
| `app/lib/bosta-locations-cache.js` | โ ููุฌูุฏ ูุณุจูุงู | ูุธุงู Cache |

---

## ููุงุญุธุงุช ูููุฉ โ๏ธ

1. **Egypt Country ID**: `60e4482c7cb7d4bc4849c4d5` (ุซุงุจุช ูู Bosta API)
2. **ูุฏุฉ Cache**: 7 ุฃูุงู (ูููู ุชุบููุฑูุง ูู `bosta-locations-cache.js`)
3. **Validation**: Bosta ุชุทูุจ `districtId` ุฃู (`districtName` + `cityId`)
4. **firstLine**: ูุฌุจ ุฃู ูููู ุฃูุซุฑ ูู 5 ุฃุญุฑู (street + area)

---

## ุงูุฎุทูุฉ ุงูุชุงููุฉ ๐

ุงูุขู ุงูุชูุงูู **ููุชูู 100%**! ููููู:

1. โ ุฅูุดุงุก ุนููุงุก ุฌุฏุฏ ูุน ุจูุงูุงุช Bosta ูุงููุฉ
2. โ ุฅุฑุณุงู ุทูุจุงุช ุชูุตูู ูุจูุณุทุฉ ุจุฏูู Validation Errors
3. โ ุชุชุจุน ุงูุดุญูุงุช ูู ุตูุญุฉ ุงูุทูุจุงุช

---

**ุชู ุจุญูุฏ ุงููู** ๐
ุชุงุฑูุฎ: ${new Date().toLocaleDateString('ar-EG')}
